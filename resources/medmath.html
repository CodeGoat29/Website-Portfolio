<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med Math Practice - DiPiazza</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="icon" type="image/png" href="/images/thegoat.png">
</head>
<body class="medmath-page">
    <div class="top-controls">
        <div class="dark-mode-toggle">
            <input type="checkbox" id="darkModeToggle" class="toggle-checkbox">
            <label for="darkModeToggle" class="toggle-label">
                <span class="toggle-switch"></span>
            </label>
        </div>
    </div>

    <header>
        <div class="container header-content">
            <a href="../index.html" class="logo-link"><img src="/images/thegoat.png" alt="DiPiazza Logo" class="logo"></a>
            <div class="header-text">
                <h1>DiPiazza</h1>
                <p class="tagline">Where I break stuff, then write about it.</p>
            </div>
            <nav>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../resources.html" class="active">Resources</a></li>
                    <li><a href="../blog.html">Blog</a></li>
                    <li><a href="../resume.html">Resume</a></li>
                    <li><button class="nav-cta" type="button" data-contact-open>Get in Touch</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="notes-header">
            <h1>Med Math Practice Game</h1>
            <p class="subtitle">Practice dose, conversion, and IV rate calculations with instant feedback.</p>
            <div class="medmath-controls">
                <label class="medmath-toggle">
                    <input type="checkbox" id="showAnalysis" checked>
                    <span>Show dimensional analysis when answer is wrong</span>
                </label>
                <div class="medmath-timer">
                    <button class="medmath-btn" type="button" id="startTimer">Start timer mode</button>
                    <button class="medmath-btn" type="button" id="shuffleQuiz">Shuffle questions</button>
                    <button class="medmath-btn" type="button" id="resetQuiz">Reset quiz</button>
                    <button class="medmath-btn" type="button" id="openHelp">Help</button>
                    <span id="timerDisplay">Timer off</span>
                </div>
            </div>
        </section>

        <section class="resources-grid medmath-grid" id="game"></section>

    <section class="medmath-score" id="finalScore" hidden>
        <h2>Final Score</h2>
        <p id="finalScoreText"></p>
        <button class="medmath-btn" type="button" id="retryGame">Retry</button>
    </section>
</main>

    <div class="medmath-help-modal" id="medmathHelp" hidden>
        <div class="medmath-help-panel" role="dialog" aria-modal="true" aria-label="Med Math Help">
            <div class="medmath-help-header">
                <h3>üß† Med Math Quick Help Guide</h3>
                <button class="medmath-btn medmath-help-close" type="button" id="closeHelp">Close</button>
            </div>

            <details class="help-item">
                <summary>1) Core Conversions (Memorize)</summary>
                <div class="help-content">
                    <ul>
                        <li><strong>1 g = 1000 mg</strong></li>
                        <li><strong>1 mg = 1000 mcg</strong></li>
                        <li><strong>1 kg = 2.2 lb</strong></li>
                        <li><strong>1 tsp = 5 mL</strong></li>
                        <li><strong>1 tbsp = 15 mL</strong></li>
                        <li><strong>1 oz = 30 mL</strong></li>
                        <li><strong>1 L = 1000 mL</strong></li>
                    </ul>
                    <p class="help-note">If units don‚Äôt match, convert first.</p>
                </div>
            </details>

            <details class="help-item">
                <summary>2) Basic Dosage Formula (Most Common)</summary>
                <div class="help-content">
                    <p><strong>Formula:</strong></p>
                    <pre><code>(Dose Ordered √∑ Dose on Hand) √ó Quantity = Amount to Give</code></pre>
                    <p><strong>Example:</strong> Order 500 mg ‚Ä¢ On hand 250 mg tablets ‚Ä¢ Quantity 1 tab</p>
                    <pre><code>(500 √∑ 250) √ó 1 = 2 tablets</code></pre>
                </div>
            </details>

            <details class="help-item">
                <summary>3) Liquid Medications</summary>
                <div class="help-content">
                    <p>Same formula ‚Äî watch <strong>mL</strong>.</p>
                    <p><strong>Example:</strong> Order 10 mg ‚Ä¢ On hand 20 mg / 5 mL</p>
                    <pre><code>(10 √∑ 20) √ó 5 = 2.5 mL</code></pre>
                </div>
            </details>

            <details class="help-item">
                <summary>4) IV Pump Rate (mL/hr)</summary>
                <div class="help-content">
                    <p><strong>Formula:</strong></p>
                    <pre><code>Total Volume (mL) √∑ Time (hr) = mL/hr</code></pre>
                    <p><strong>Example:</strong> 1000 mL over 8 hr</p>
                    <pre><code>1000 √∑ 8 = 125 mL/hr</code></pre>
                </div>
            </details>

            <details class="help-item">
                <summary>5) IV Drip Rate (gtt/min)</summary>
                <div class="help-content">
                    <p><strong>Formula:</strong></p>
                    <pre><code>(mL √ó drop factor) √∑ minutes = gtt/min</code></pre>
                    <p><strong>Example:</strong> 500 mL over 4 hr ‚Ä¢ Drop factor 15 gtt/mL</p>
                    <pre><code>(500 √ó 15) √∑ 240 = 31 gtt/min</code></pre>
                    <p class="help-note">Round drops to a whole number.</p>
                </div>
            </details>

            <details class="help-item">
                <summary>6) Weight-Based Dosing (kg only)</summary>
                <div class="help-content">
                    <ol>
                        <li>Convert lb ‚Üí kg</li>
                        <li>Multiply by ordered dose (mg/kg)</li>
                        <li>Use dosage formula if needed</li>
                    </ol>
                    <p><strong>Example:</strong> 22 lb child ‚Ä¢ Order 10 mg/kg</p>
                    <pre><code>22 √∑ 2.2 = 10 kg
10 √ó 10 = 100 mg</code></pre>
                </div>
            </details>

            <details class="help-item">
                <summary>7) Insulin Basics</summary>
                <div class="help-content">
                    <ul>
                        <li><strong>U-100 insulin</strong> = 100 units per 1 mL</li>
                        <li>Insulin syringes are marked in <strong>units</strong></li>
                        <li>Don‚Äôt convert to mL unless asked</li>
                    </ul>
                    <p><strong>Example:</strong> Order 15 units ‚Üí draw up <strong>15 units</strong></p>
                </div>
            </details>

            <details class="help-item">
                <summary>8) Rounding Rules (Test Favorite)</summary>
                <div class="help-content">
                    <ul>
                        <li><strong>Tablets:</strong> nearest half or whole (if scored)</li>
                        <li><strong>mL (oral):</strong> nearest tenth (0.1)</li>
                        <li><strong>IV pump:</strong> whole number (unless told otherwise)</li>
                        <li><strong>Drops (gtt/min):</strong> whole number</li>
                        <li><strong>Insulin:</strong> whole number</li>
                    </ul>
                    <p class="help-note">If the question says ‚Äúround to the nearest tenth,‚Äù do exactly that.</p>
                </div>
            </details>

            <details class="help-item">
                <summary>9) Dimensional Analysis (Unit-Cancel Method)</summary>
                <div class="help-content">
                    <p>Write it top to bottom and cancel units as you go:</p>
                    <pre><code>Ordered unit
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ √ó Quantity
On-hand unit</code></pre>
                    <p class="help-note">If units cancel correctly, you‚Äôre usually right.</p>
                </div>
            </details>

            <details class="help-item">
                <summary>10) Common Test Traps + Final Check</summary>
                <div class="help-content">
                    <p><strong>Traps:</strong></p>
                    <ul>
                        <li>Forgetting lb ‚Üí kg</li>
                        <li>Mixing mg and mcg</li>
                        <li>Rounding too early</li>
                        <li>Giving mL instead of tablets (or vice versa)</li>
                        <li>Ignoring drop factor</li>
                    </ul>

                    <p><strong>Quick check before submitting:</strong></p>
                    <ul>
                        <li>Units match?</li>
                        <li>Answer reasonable?</li>
                        <li>Rounded correctly?</li>
                        <li>Route makes sense?</li>
                    </ul>
                </div>
            </details>
        </div>
    </div>

    <div class="contact-modal" id="contactModal">
        <div class="contact-modal-content">
            <div class="contact-modal-header">
                <h3>Get in Touch</h3>
                <button class="contact-modal-close" type="button" id="contactModalClose">‚úï</button>
            </div>
            <div class="contact-modal-links">
                <a href="mailto:daviddipiazza29@gmail.com" class="contact-link">Email</a>
                <a href="https://www.linkedin.com/in/david-dipiazza/" target="_blank" class="contact-link">LinkedIn</a>
                <a href="https://github.com/CodeGoat29" target="_blank" class="contact-link">GitHub</a>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container footer-grid">
            <div>
                <h4>Explore</h4>
                <ul>
                    <li><a href="../resources.html">Resources</a></li>
                    <li><a href="../blog.html">Blog</a></li>
                    <li><a href="../resume.html">Resume</a></li>
                </ul>
            </div>
            <div>
                <h4>Connect</h4>
                <ul>
                    <li><a href="mailto:daviddipiazza29@gmail.com">Email</a></li>
                    <li><a href="https://www.linkedin.com/in/david-dipiazza/" target="_blank">LinkedIn</a></li>
                    <li><a href="https://github.com/CodeGoat29" target="_blank">GitHub</a></li>
                </ul>
            </div>
        </div>
        <div class="container footer-bar">
            <p>&copy; 2026 DiPiazza.org | All Rights Reserved</p>
        </div>
    </footer>

    <script>
        const questions = [
            {
                q: "Order: 500 mg. Available: 250 mg per tablet. How many tablets?",
                answer: 2,
                explanation: "500 mg √∑ 250 mg/tablet = 2 tablets.",
                dim: "(500 mg) √∑ (250 mg/tablet) = 2 tablets."
            },
            {
                q: "Order: 1 g. Available: 250 mg tablets. How many tablets?",
                answer: 4,
                explanation: "(1 g √ó 1000 mg/1 g) √∑ (250 mg/tablet) = 4 tablets.",
                dim: "(1 g √ó 1000 mg/1 g) √∑ (250 mg/tablet) = 4 tablets."
            },
            {
                q: "Order: 30 mg. Available: 10 mg/mL. How many mL?",
                answer: 3,
                explanation: "(30 mg) √∑ (10 mg/mL) = 3 mL.",
                dim: "(30 mg) √∑ (10 mg/mL) = 3 mL."
            },
            {
                q: "Order: 0.5 g. Available: 250 mg tablets. How many tablets?",
                answer: 2,
                explanation: "(0.5 g √ó 1000 mg/1 g) √∑ (250 mg/tablet) = 2 tablets.",
                dim: "(0.5 g √ó 1000 mg/1 g) √∑ (250 mg/tablet) = 2 tablets."
            },
            {
                q: "Order: 1000 mL IV over 8 hours. mL/hr?",
                answer: 125,
                explanation: "(1000 mL) √∑ (8 hr) = 125 mL/hr.",
                dim: "(1000 mL) √∑ (8 hr) = 125 mL/hr."
            },
            {
                q: "Order: 500 mL over 4 hours. mL/hr?",
                answer: 125,
                explanation: "(500 mL) √∑ (4 hr) = 125 mL/hr.",
                dim: "(500 mL) √∑ (4 hr) = 125 mL/hr."
            },
            {
                q: "Order: 250 mg. Available: 500 mg/5 mL. How many mL?",
                answer: 2.5,
                explanation: "(250 mg) √ó (5 mL/500 mg) = 2.5 mL.",
                dim: "(250 mg) √ó (5 mL/500 mg) = 2.5 mL."
            },
            {
                q: "Order: 60 mg. Available: 20 mg/mL. How many mL?",
                answer: 3,
                explanation: "(60 mg) √∑ (20 mg/mL) = 3 mL.",
                dim: "(60 mg) √∑ (20 mg/mL) = 3 mL."
            },
            {
                q: "Order: 2 L IV fluids. How many mL?",
                answer: 2000,
                explanation: "(2 L) √ó (1000 mL/1 L) = 2000 mL.",
                dim: "(2 L) √ó (1000 mL/1 L) = 2000 mL."
            },
            {
                q: "Order: 0.25 g. Available: 125 mg tablets. How many tablets?",
                answer: 2,
                explanation: "(0.25 g √ó 1000 mg/1 g) √∑ (125 mg/tablet) = 2 tablets.",
                dim: "(0.25 g √ó 1000 mg/1 g) √∑ (125 mg/tablet) = 2 tablets."
            },
            {
                q: "Order: 75 mL/hr for 6 hours. Total mL infused?",
                answer: 450,
                explanation: "(75 mL/hr) √ó (6 hr) = 450 mL.",
                dim: "(75 mL/hr) √ó (6 hr) = 450 mL."
            },
            {
                q: "Order: 800 mg. Available: 400 mg tablets. How many tablets?",
                answer: 2,
                explanation: "(800 mg) √∑ (400 mg/tablet) = 2 tablets.",
                dim: "(800 mg) √∑ (400 mg/tablet) = 2 tablets."
            },
            {
                q: "Order: 0.75 g. Available: 250 mg tablets. How many tablets?",
                answer: 3,
                explanation: "0.75 g = 750 mg. 750 √∑ 250 = 3 tablets.",
                dim: "0.75 g √ó (1000 mg / 1 g) √ó (1 tablet / 250 mg) = 3 tablets"
            },
            {
                q: "Order: 90 mg. Available: 30 mg/mL. How many mL?",
                answer: 3,
                explanation: "90 √∑ 30 = 3 mL.",
                dim: "90 mg √ó (1 mL / 30 mg) = 3 mL"
            },
            {
                q: "Order: 1.5 L IV fluids. How many mL?",
                answer: 1500,
                explanation: "1 L = 1000 mL ‚Üí 1.5 L = 1500 mL.",
                dim: "1.5 L √ó (1000 mL / 1 L) = 1500 mL"
            },
            {
                q: "Order: 300 mg. Available: 600 mg/10 mL. How many mL?",
                answer: 5,
                explanation: "600 mg in 10 mL ‚Üí half the dose is 5 mL.",
                dim: "300 mg √ó (10 mL / 600 mg) = 5 mL"
            },
            {
                q: "Order: 50 mL/hr for 8 hours. Total mL infused?",
                answer: 400,
                explanation: "50 √ó 8 = 400 mL.",
                dim: "50 (mL/hr) √ó 8 hr = 400 mL"
            },
            {
                q: "Order: 0.2 g. Available: 100 mg tablets. How many tablets?",
                answer: 2,
                explanation: "0.2 g = 200 mg. 200 √∑ 100 = 2 tablets.",
                dim: "0.2 g √ó (1000 mg / 1 g) √ó (1 tablet / 100 mg) = 2 tablets"
            },
            {
                q: "Order: 45 mg. Available: 15 mg/mL. How many mL?",
                answer: 3,
                explanation: "45 √∑ 15 = 3 mL.",
                dim: "45 mg √ó (1 mL / 15 mg) = 3 mL"
            },
            {
                q: "Order: 1200 mL IV over 10 hours. mL/hr?",
                answer: 120,
                explanation: "1200 √∑ 10 = 120 mL/hr.",
                dim: "1200 mL √ó (1 hr / 10 hr) = 120 mL/hr"
            }
        ];
        const originalQuestions = questions.map(item => ({ ...item }));

        const gameDiv = document.getElementById("game");
        const showAnalysisToggle = document.getElementById("showAnalysis");
        const timerDisplay = document.getElementById("timerDisplay");
        const startTimerBtn = document.getElementById("startTimer");
        const shuffleQuizBtn = document.getElementById("shuffleQuiz");
        const resetQuizBtn = document.getElementById("resetQuiz");
        const openHelpBtn = document.getElementById("openHelp");
        const closeHelpBtn = document.getElementById("closeHelp");
        const helpModal = document.getElementById("medmathHelp");
        const finalScore = document.getElementById("finalScore");
        const finalScoreText = document.getElementById("finalScoreText");
        const retryGame = document.getElementById("retryGame");
        let score = 0;
        let answered = 0;
        let timerId = null;
        let secondsLeft = 0;
        const timerDuration = 1800;

        function renderQuestions() {
            gameDiv.innerHTML = '';
            questions.forEach((item, index) => {
                const div = document.createElement("div");
                div.className = "resource-card medmath-question";
                div.innerHTML = `
                    <h3>Question ${index + 1}</h3>
                    <p>${item.q}</p>
                    <div class="medmath-input-row">
                        <input type="number" step="0.01" id="answer-${index}" placeholder="Answer">
                        <button class="medmath-btn" type="button" data-check="${index}">Check</button>
                    </div>
                    <div id="feedback-${index}" class="feedback"></div>
                    <div id="explanation-${index}" class="explanation"></div>
                    <div id="dim-${index}" class="medmath-dim">${item.dim || ''}</div>
                `;
                gameDiv.appendChild(div);
            });
            updateExplanationsVisibility();
        }

        function updateExplanationsVisibility() {
            document.querySelectorAll('.medmath-dim').forEach((el) => {
                el.style.display = 'none';
            });
        }

        function endGame(reason) {
            clearInterval(timerId);
            timerId = null;
            const total = questions.length;
            finalScore.hidden = false;
            finalScoreText.textContent = `You scored ${score} out of ${total}. ${reason}`;
            document.querySelectorAll('[data-check]').forEach(btn => btn.disabled = true);
            document.querySelectorAll('#game input').forEach(input => input.disabled = true);
        }

        function startTimer() {
            if (timerId) return;
            secondsLeft = timerDuration;
            timerDisplay.textContent = `Time left: ${Math.floor(secondsLeft / 60)}:${String(secondsLeft % 60).padStart(2, '0')}`;
            startTimerBtn.textContent = 'Restart timer';
            timerId = setInterval(() => {
                secondsLeft -= 1;
                timerDisplay.textContent = `Time left: ${Math.floor(secondsLeft / 60)}:${String(secondsLeft % 60).padStart(2, '0')}`;
                if (secondsLeft <= 0) {
                    endGame('Time is up.');
                }
            }, 1000);
        }

        function restartTimer() {
            clearInterval(timerId);
            timerId = null;
            startTimer();
        }

        function shuffleQuestions() {
            for (let i = questions.length - 1; i > 0; i -= 1) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
            resetQuiz(false, true);
        }

        function resetQuiz(resetOrder = true, preserveTimer = false) {
            if (resetOrder) {
                questions.splice(0, questions.length, ...originalQuestions.map(item => ({ ...item })));
            }
            score = 0;
            answered = 0;
            finalScore.hidden = true;
            finalScoreText.textContent = '';
            if (!preserveTimer) {
                timerDisplay.textContent = 'Timer off';
                startTimerBtn.textContent = 'Start timer mode';
                clearInterval(timerId);
                timerId = null;
            }
            renderQuestions();
        }

        showAnalysisToggle.addEventListener('change', updateExplanationsVisibility);

        startTimerBtn.addEventListener('click', () => {
            if (timerId) {
                restartTimer();
            } else {
                startTimer();
            }
        });

        shuffleQuizBtn.addEventListener('click', shuffleQuestions);
        resetQuizBtn.addEventListener('click', () => resetQuiz(true));

        retryGame.addEventListener('click', () => {
            resetQuiz(true);
        });

        function closeHelp() {
            helpModal.hidden = true;
        }

        openHelpBtn.addEventListener('click', () => {
            helpModal.hidden = false;
        });

        closeHelpBtn.addEventListener('click', closeHelp);

        helpModal.addEventListener('click', (event) => {
            if (event.target === helpModal) {
                closeHelp();
            }
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && !helpModal.hidden) {
                closeHelp();
            }
        });

        gameDiv.addEventListener('click', (event) => {
            const btn = event.target.closest('[data-check]');
            if (!btn) return;
            const index = Number(btn.dataset.check);
            const userAnswer = parseFloat(document.getElementById(`answer-${index}`).value);
            const feedback = document.getElementById(`feedback-${index}`);
            const explanation = document.getElementById(`explanation-${index}`);
            const dimBlock = document.getElementById(`dim-${index}`);

            if (!Number.isFinite(userAnswer)) {
                feedback.textContent = "Enter a number.";
                feedback.className = "feedback incorrect";
                explanation.textContent = "";
                dimBlock.style.display = 'none';
                return;
            }

            if (userAnswer === questions[index].answer) {
                feedback.textContent = "‚úÖ Correct!";
                feedback.className = "feedback correct";
                explanation.textContent = "";
                dimBlock.style.display = 'none';
                if (!btn.dataset.answered) {
                    score += 1;
                }
            } else {
                feedback.textContent = "‚ùå Incorrect";
                feedback.className = "feedback incorrect";
                explanation.textContent = questions[index].explanation;
                if (showAnalysisToggle.checked) {
                    dimBlock.style.display = '';
                } else {
                    dimBlock.style.display = 'none';
                }
            }
            btn.dataset.answered = 'true';
            answered += 1;
            if (answered >= questions.length) {
                endGame('You answered all questions.');
            }
        });

        renderQuestions();
    </script>
    <script src="../js/site.js"></script>
</body>
</html>
